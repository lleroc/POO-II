using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using mysql.DATOS;

namespace mysql
{
    internal static class Program
    {
        /// <summary>
        ///  The main entry point for the application.
        /// </summary>
        /// 

        public static IServiceProvider ServiceProvier { get; private set; }

        [STAThread]
        static void Main()
        {
            try
            {
                //1. Construir la configuracion y leer app.json
                var builderConfig = new ConfigurationBuilder()
               .SetBasePath(AppDomain.CurrentDomain.BaseDirectory)
               .AddJsonFile("app.json", optional: false, reloadOnChange: true);
               


                IConfiguration configuration = builderConfig.Build();
                //2. Configurar serivicios
                var services = new ServiceCollection();
                // Connection string desde app.json
                var cn = configuration.GetConnectionString("cnjson");
                // 3. Configurar DbConctext con Mysql (Pomelo)
                services.AddDbContext<Mysql_DBContext>(op => 
                op.UseMySql(cn, ServerVersion.AutoDetect(cn)));

                services.AddTransient<Form1>();

                ServiceProvier = services.BuildServiceProvider();

                ApplicationConfiguration.Initialize();
                var form1 = ServiceProvier.GetRequiredService<Form1>();
                Application.Run(form1);
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);

            }
           
        }
    }
}